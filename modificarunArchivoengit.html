

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Archivos en GitHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Gestión de Archivos en GitHub</h1>
        <form id="githubForm">
            <div class="mb-3">
                <label for="path" class="form-label">Ruta del Archivo</label>
                <input type="text" class="form-control" id="path" placeholder="Ejemplo: ruta/al/archivo.txt">
            </div>
            <div class="mb-3">
                <label for="content" class="form-label">Contenido</label>
                <textarea class="form-control" id="content" rows="5" placeholder="Escribe el contenido del archivo"></textarea>
            </div>
            <div class="mb-3">
                <label for="file" class="form-label">Cargar Archivo desde tu PC</label>
                <input type="file" class="form-control" id="file">
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-primary" id="listar">Listar Archivos</button>
                <button type="button" class="btn btn-info" id="consultar">Consultar Archivo</button>
                <button type="button" class="btn btn-success" id="agregar">Agregar Archivo</button>
                <button type="button" class="btn btn-warning" id="modificar">Modificar Archivo</button>
                <button type="button" class="btn btn-danger" id="eliminar">Eliminar Archivo</button>
            </div>
        </form>
        <div id="fileList" class="mt-4"></div>
        <div id="result" class="mt-4"></div>
    </div>

    <script type="module">
        import { Octokit } from "https://cdn.skypack.dev/@octokit/rest";

        // Configuración inicial
        const token = "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"; // Agrega tu token aquí
        const owner = "fastreds"; // Agrega tu usuario aquí
        const repo = "AppRevAmbulancias"; // Agrega tu repositorio aquí
        const octokit = new Octokit({ auth: token });

        function mostrarResultado(tipo, mensaje) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="alert alert-${tipo}">${mensaje}</div>`;
        }

        async function confirmarAccion(mensaje) {
            return confirm(mensaje);
        }

        // Listar archivos
        document.getElementById('listar').addEventListener('click', async () => {
            try {
                const { data } = await octokit.request('GET /repos/{owner}/{repo}/contents', { owner, repo });
                const fileListDiv = document.getElementById('fileList');
                fileListDiv.innerHTML = '<h5>Archivos en el Repositorio:</h5><ul class="list-group">';
                data.forEach(file => {
                    fileListDiv.innerHTML += `<li class="list-group-item">${file.path}</li>`;
                });
                fileListDiv.innerHTML += '</ul>';
                mostrarResultado('success', 'Archivos listados exitosamente.');
            } catch (error) {
                mostrarResultado('danger', `Error al listar archivos: ${error.message}`);
            }
        });

        // Consultar archivo
        document.getElementById('consultar').addEventListener('click', async () => {
            const path = document.getElementById('path').value;
            if (!path) return mostrarResultado('danger', 'La ruta del archivo es requerida.');
            try {
                const { data } = await octokit.request('GET /repos/{owner}/{repo}/contents/{path}', { owner, repo, path });
                document.getElementById('content').value = decodeBase64(data.content);//atob(data.content);
                mostrarResultado('success', 'Archivo consultado exitosamente.');
            } catch (error) {
                mostrarResultado('danger', `Error al consultar archivo: ${error.message}`);
            }
        });

        // Agregar archivo
        document.getElementById('agregar').addEventListener('click', async () => {
            const path = document.getElementById('path').value;
            const fileInput = document.getElementById('file');
            let content = document.getElementById('content').value;

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                content = await file.text();
            }
            if (!path || !content) return mostrarResultado('danger', 'Ruta y contenido son requeridos.');

            if (!await confirmarAccion('¿Seguro que deseas agregar este archivo?')) return;

            try {
                await octokit.request('PUT /repos/{owner}/{repo}/contents/{path}', {
                    owner,
                    repo,
                    path,
                    message: 'Agregado archivo desde el formulario',
                    content: btoa(content),
                });
                mostrarResultado('success', 'Archivo agregado exitosamente.');
            } catch (error) {
                mostrarResultado('danger', `Error al agregar archivo: ${error.message}`);
            }
        });

        // Modificar archivo
        document.getElementById('modificar').addEventListener('click', async () => {
            const path = document.getElementById('path').value;
            const content = document.getElementById('content').value;

            if (!path || !content) return mostrarResultado('danger', 'Ruta y contenido son requeridos.');

            if (!await confirmarAccion('¿Seguro que deseas modificar este archivo?')) return;

            try {
                const { data } = await octokit.request('GET /repos/{owner}/{repo}/contents/{path}', { owner, repo, path });
                await octokit.request('PUT /repos/{owner}/{repo}/contents/{path}', {
                    owner,
                    repo,
                    path,
                    message: 'Modificado archivo desde el formulario',
                    content: btoa(content),
                    sha: data.sha,
                });
                mostrarResultado('success', 'Archivo modificado exitosamente.');
            } catch (error) {
                mostrarResultado('danger', `Error al modificar archivo: ${error.message}`);
            }
        });

        // Eliminar archivo
        document.getElementById('eliminar').addEventListener('click', async () => {
            const path = document.getElementById('path').value;

            if (!path) return mostrarResultado('danger', 'La ruta del archivo es requerida.');

            if (!await confirmarAccion('¿Seguro que deseas eliminar este archivo?')) return;

            try {
                const { data } = await octokit.request('GET /repos/{owner}/{repo}/contents/{path}', { owner, repo, path });
                await octokit.request('DELETE /repos/{owner}/{repo}/contents/{path}', {
                    owner,
                    repo,
                    path,
                    message: 'Eliminado archivo desde el formulario',
                    sha: data.sha,
                });
                mostrarResultado('success', 'Archivo eliminado exitosamente.');
            } catch (error) {
                mostrarResultado('danger', `Error al eliminar archivo: ${error.message}`);
            }
        });


        function decodeBase64(base64Encoded) {
    // Decodificar la cadena Base64 usando atob()
    const decoded = atob(base64Encoded);

    // Convertir la cadena decodificada de Base64 a UTF-8 correctamente
    const utf8Decoded = decodeURIComponent(escape(decoded));

    return utf8Decoded;
}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
